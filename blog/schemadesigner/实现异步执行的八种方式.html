<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>å®ç°å¼‚æ­¥çš„ 8 ç§æ–¹å¼ | BXuanéšç¬”</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/logo.jpg">
    <meta name="description" content="æ¬¢è¿æ¥åˆ° BXuan çš„âœ¨ä¸ªäººç½‘ç«™âœ¨ğŸ‘ğŸ‘ğŸ‘ï¼">
    
    <link rel="preload" href="/assets/css/0.styles.72717b73.css" as="style"><link rel="preload" href="/assets/js/app.c7952645.js" as="script"><link rel="preload" href="/assets/js/2.53ba99d7.js" as="script"><link rel="preload" href="/assets/js/74.91e1d2ef.js" as="script"><link rel="prefetch" href="/assets/js/10.4ab63f7a.js"><link rel="prefetch" href="/assets/js/11.982bd386.js"><link rel="prefetch" href="/assets/js/12.0b6105e0.js"><link rel="prefetch" href="/assets/js/13.0b88c945.js"><link rel="prefetch" href="/assets/js/14.32b6e670.js"><link rel="prefetch" href="/assets/js/15.1651a6b7.js"><link rel="prefetch" href="/assets/js/16.55e08c05.js"><link rel="prefetch" href="/assets/js/17.6d98ee08.js"><link rel="prefetch" href="/assets/js/18.fc4ae118.js"><link rel="prefetch" href="/assets/js/19.ea630d0e.js"><link rel="prefetch" href="/assets/js/20.6151654c.js"><link rel="prefetch" href="/assets/js/21.1ddadd96.js"><link rel="prefetch" href="/assets/js/22.6e312c0e.js"><link rel="prefetch" href="/assets/js/23.ab691b41.js"><link rel="prefetch" href="/assets/js/24.6667f20a.js"><link rel="prefetch" href="/assets/js/25.517e4303.js"><link rel="prefetch" href="/assets/js/26.c92294b8.js"><link rel="prefetch" href="/assets/js/27.30245c81.js"><link rel="prefetch" href="/assets/js/28.83f84f64.js"><link rel="prefetch" href="/assets/js/29.2ebf177e.js"><link rel="prefetch" href="/assets/js/3.c16bd42d.js"><link rel="prefetch" href="/assets/js/30.15f1115b.js"><link rel="prefetch" href="/assets/js/31.271bb831.js"><link rel="prefetch" href="/assets/js/32.a3ffc84b.js"><link rel="prefetch" href="/assets/js/33.837c492d.js"><link rel="prefetch" href="/assets/js/34.6535b864.js"><link rel="prefetch" href="/assets/js/35.a9f35d11.js"><link rel="prefetch" href="/assets/js/36.58c71fa7.js"><link rel="prefetch" href="/assets/js/37.536c34aa.js"><link rel="prefetch" href="/assets/js/38.dca08340.js"><link rel="prefetch" href="/assets/js/39.20e843ec.js"><link rel="prefetch" href="/assets/js/4.d6c515d3.js"><link rel="prefetch" href="/assets/js/40.f33282da.js"><link rel="prefetch" href="/assets/js/41.0afdb83a.js"><link rel="prefetch" href="/assets/js/42.68f5e469.js"><link rel="prefetch" href="/assets/js/43.65a3e240.js"><link rel="prefetch" href="/assets/js/44.0429a345.js"><link rel="prefetch" href="/assets/js/45.61c6d807.js"><link rel="prefetch" href="/assets/js/46.69ea8e4b.js"><link rel="prefetch" href="/assets/js/47.21cbd519.js"><link rel="prefetch" href="/assets/js/48.b46e7243.js"><link rel="prefetch" href="/assets/js/49.8f93a744.js"><link rel="prefetch" href="/assets/js/5.65846da7.js"><link rel="prefetch" href="/assets/js/50.323a9f2b.js"><link rel="prefetch" href="/assets/js/51.731382e7.js"><link rel="prefetch" href="/assets/js/52.429c91e1.js"><link rel="prefetch" href="/assets/js/53.6ad30434.js"><link rel="prefetch" href="/assets/js/54.c2c209db.js"><link rel="prefetch" href="/assets/js/55.36509a79.js"><link rel="prefetch" href="/assets/js/56.442c1774.js"><link rel="prefetch" href="/assets/js/57.104714c1.js"><link rel="prefetch" href="/assets/js/58.d1eb3d61.js"><link rel="prefetch" href="/assets/js/59.7642ee42.js"><link rel="prefetch" href="/assets/js/6.1cca85df.js"><link rel="prefetch" href="/assets/js/60.497110a7.js"><link rel="prefetch" href="/assets/js/61.9456cece.js"><link rel="prefetch" href="/assets/js/62.4acf84cc.js"><link rel="prefetch" href="/assets/js/63.649869e0.js"><link rel="prefetch" href="/assets/js/64.a9a2a5e7.js"><link rel="prefetch" href="/assets/js/65.caf50992.js"><link rel="prefetch" href="/assets/js/66.a082df91.js"><link rel="prefetch" href="/assets/js/67.77906dd6.js"><link rel="prefetch" href="/assets/js/68.b187b7a3.js"><link rel="prefetch" href="/assets/js/69.d4e466ec.js"><link rel="prefetch" href="/assets/js/7.e19e61cb.js"><link rel="prefetch" href="/assets/js/70.d3e767af.js"><link rel="prefetch" href="/assets/js/71.b195f372.js"><link rel="prefetch" href="/assets/js/72.394bd04d.js"><link rel="prefetch" href="/assets/js/73.cca17919.js"><link rel="prefetch" href="/assets/js/75.6f26e213.js"><link rel="prefetch" href="/assets/js/76.9ae90df7.js"><link rel="prefetch" href="/assets/js/77.1220dc5d.js"><link rel="prefetch" href="/assets/js/78.d80a520f.js"><link rel="prefetch" href="/assets/js/79.d22d4bb9.js"><link rel="prefetch" href="/assets/js/8.c222cd7c.js"><link rel="prefetch" href="/assets/js/9.55b8fde2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.72717b73.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.jpg" alt="BXuanéšç¬”" class="logo"> <span class="site-name can-hide">BXuanéšç¬”</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="è®¡ç®—æœºåŸºç¡€" class="dropdown-title"><span class="title">è®¡ç®—æœºåŸºç¡€</span> <span class="arrow down"></span></button> <button type="button" aria-label="è®¡ç®—æœºåŸºç¡€" class="mobile-dropdown-title"><span class="title">è®¡ç®—æœºåŸºç¡€</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/network/" class="nav-link">
  ğŸ”è®¡ç®—æœºç½‘ç»œ
</a></li><li class="dropdown-item"><!----> <a href="/blog/os/" class="nav-link">
  ğŸŸæ“ä½œç³»ç»Ÿ
</a></li><li class="dropdown-item"><!----> <a href="/blog/algo/" class="nav-link">
  ğŸ•æ•°æ®ç»“æ„ä¸ç®—æ³•
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç¼–ç¨‹è¯­è¨€" class="dropdown-title"><span class="title">ç¼–ç¨‹è¯­è¨€</span> <span class="arrow down"></span></button> <button type="button" aria-label="ç¼–ç¨‹è¯­è¨€" class="mobile-dropdown-title"><span class="title">ç¼–ç¨‹è¯­è¨€</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/java/" class="nav-link">
  ğŸŒ­Java
</a></li><li class="dropdown-item"><!----> <a href="/blog/go/" class="nav-link">
  ğŸ¿Go
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="è½¯ä»¶å¼€å‘" class="dropdown-title"><span class="title">è½¯ä»¶å¼€å‘</span> <span class="arrow down"></span></button> <button type="button" aria-label="è½¯ä»¶å¼€å‘" class="mobile-dropdown-title"><span class="title">è½¯ä»¶å¼€å‘</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          ğŸŒ®æ•°æ®åº“
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-subitem"><a href="/blog/redis/" class="nav-link">
  Redis
</a></li></ul></li><li class="dropdown-item"><h4>
          ğŸ¥ªå¼€å‘æ¡†æ¶
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/frame/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-subitem"><a href="/blog/frame/springboot/" class="nav-link">
  SpringBoot
</a></li></ul></li><li class="dropdown-item"><h4>
          ğŸ¥Ÿæ¶æ„è®¾è®¡
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/schemadesigner/" class="nav-link router-link-active">
  è®¾è®¡æ¨¡å¼
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="è½¯ä»¶æµ‹è¯•" class="dropdown-title"><span class="title">è½¯ä»¶æµ‹è¯•</span> <span class="arrow down"></span></button> <button type="button" aria-label="è½¯ä»¶æµ‹è¯•" class="mobile-dropdown-title"><span class="title">è½¯ä»¶æµ‹è¯•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/softwaretest/baseOfSoftwareTest/" class="nav-link">
  ğŸ¥“è½¯ä»¶æµ‹è¯•åŸºç¡€
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ–‡ç« é˜…è¯»" class="dropdown-title"><span class="title">æ–‡ç« é˜…è¯»</span> <span class="arrow down"></span></button> <button type="button" aria-label="æ–‡ç« é˜…è¯»" class="mobile-dropdown-title"><span class="title">æ–‡ç« é˜…è¯»</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/interview/all.html" class="nav-link">
  ğŸ’ªé¢ç»æ±‡æ€»
</a></li><li class="dropdown-item"><!----> <a href="/blog/other/" class="nav-link">
  ğŸ§€å…¶ä»–é˜…è¯»
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/BXuan-Yang" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GithubğŸ™‹â€â™‚ï¸
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="è®¡ç®—æœºåŸºç¡€" class="dropdown-title"><span class="title">è®¡ç®—æœºåŸºç¡€</span> <span class="arrow down"></span></button> <button type="button" aria-label="è®¡ç®—æœºåŸºç¡€" class="mobile-dropdown-title"><span class="title">è®¡ç®—æœºåŸºç¡€</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/network/" class="nav-link">
  ğŸ”è®¡ç®—æœºç½‘ç»œ
</a></li><li class="dropdown-item"><!----> <a href="/blog/os/" class="nav-link">
  ğŸŸæ“ä½œç³»ç»Ÿ
</a></li><li class="dropdown-item"><!----> <a href="/blog/algo/" class="nav-link">
  ğŸ•æ•°æ®ç»“æ„ä¸ç®—æ³•
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç¼–ç¨‹è¯­è¨€" class="dropdown-title"><span class="title">ç¼–ç¨‹è¯­è¨€</span> <span class="arrow down"></span></button> <button type="button" aria-label="ç¼–ç¨‹è¯­è¨€" class="mobile-dropdown-title"><span class="title">ç¼–ç¨‹è¯­è¨€</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/java/" class="nav-link">
  ğŸŒ­Java
</a></li><li class="dropdown-item"><!----> <a href="/blog/go/" class="nav-link">
  ğŸ¿Go
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="è½¯ä»¶å¼€å‘" class="dropdown-title"><span class="title">è½¯ä»¶å¼€å‘</span> <span class="arrow down"></span></button> <button type="button" aria-label="è½¯ä»¶å¼€å‘" class="mobile-dropdown-title"><span class="title">è½¯ä»¶å¼€å‘</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          ğŸŒ®æ•°æ®åº“
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-subitem"><a href="/blog/redis/" class="nav-link">
  Redis
</a></li></ul></li><li class="dropdown-item"><h4>
          ğŸ¥ªå¼€å‘æ¡†æ¶
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/frame/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-subitem"><a href="/blog/frame/springboot/" class="nav-link">
  SpringBoot
</a></li></ul></li><li class="dropdown-item"><h4>
          ğŸ¥Ÿæ¶æ„è®¾è®¡
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/schemadesigner/" class="nav-link router-link-active">
  è®¾è®¡æ¨¡å¼
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="è½¯ä»¶æµ‹è¯•" class="dropdown-title"><span class="title">è½¯ä»¶æµ‹è¯•</span> <span class="arrow down"></span></button> <button type="button" aria-label="è½¯ä»¶æµ‹è¯•" class="mobile-dropdown-title"><span class="title">è½¯ä»¶æµ‹è¯•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/softwaretest/baseOfSoftwareTest/" class="nav-link">
  ğŸ¥“è½¯ä»¶æµ‹è¯•åŸºç¡€
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ–‡ç« é˜…è¯»" class="dropdown-title"><span class="title">æ–‡ç« é˜…è¯»</span> <span class="arrow down"></span></button> <button type="button" aria-label="æ–‡ç« é˜…è¯»" class="mobile-dropdown-title"><span class="title">æ–‡ç« é˜…è¯»</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/interview/all.html" class="nav-link">
  ğŸ’ªé¢ç»æ±‡æ€»
</a></li><li class="dropdown-item"><!----> <a href="/blog/other/" class="nav-link">
  ğŸ§€å…¶ä»–é˜…è¯»
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/BXuan-Yang" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GithubğŸ™‹â€â™‚ï¸
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/schemadesigner/DesignMode.html" class="sidebar-link">ç›˜ç‚¹å¸¸è§çš„äºŒåä¸‰ç§è®¾è®¡æ¨¡å¼</a></li><li><a href="/blog/schemadesigner/å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¹¶å‘ç³»ç»Ÿ.html" class="sidebar-link">å¦‚ä½•è®¾è®¡ä¸€ä¸ªä¼˜ç§€çš„é«˜å¹¶å‘ç³»ç»Ÿ</a></li><li><a href="/blog/schemadesigner/å®ç°å¼‚æ­¥æ‰§è¡Œçš„å…«ç§æ–¹å¼.html" class="active sidebar-link">å®ç°å¼‚æ­¥çš„ 8 ç§æ–¹å¼</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/schemadesigner/å®ç°å¼‚æ­¥æ‰§è¡Œçš„å…«ç§æ–¹å¼.html#ä¸€ã€å‰è¨€" class="sidebar-link">ä¸€ã€å‰è¨€</a></li><li class="sidebar-sub-header"><a href="/blog/schemadesigner/å®ç°å¼‚æ­¥æ‰§è¡Œçš„å…«ç§æ–¹å¼.html#äºŒã€å®ç°å¼‚æ­¥çš„-8-ç§æ–¹å¼" class="sidebar-link">äºŒã€å®ç°å¼‚æ­¥çš„ 8 ç§æ–¹å¼</a></li><li class="sidebar-sub-header"><a href="/blog/schemadesigner/å®ç°å¼‚æ­¥æ‰§è¡Œçš„å…«ç§æ–¹å¼.html#ä¸‰ã€ä»€ä¹ˆæ˜¯å¼‚æ­¥" class="sidebar-link">ä¸‰ã€ä»€ä¹ˆæ˜¯å¼‚æ­¥ï¼Ÿ</a></li><li class="sidebar-sub-header"><a href="/blog/schemadesigner/å®ç°å¼‚æ­¥æ‰§è¡Œçš„å…«ç§æ–¹å¼.html#å››ã€å¼‚æ­¥ç¼–ç¨‹" class="sidebar-link">å››ã€å¼‚æ­¥ç¼–ç¨‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/schemadesigner/å®ç°å¼‚æ­¥æ‰§è¡Œçš„å…«ç§æ–¹å¼.html#_4-1-çº¿ç¨‹å¼‚æ­¥" class="sidebar-link">4.1 çº¿ç¨‹å¼‚æ­¥</a></li><li class="sidebar-sub-header"><a href="/blog/schemadesigner/å®ç°å¼‚æ­¥æ‰§è¡Œçš„å…«ç§æ–¹å¼.html#_4-2future-å¼‚æ­¥" class="sidebar-link">4.2Future å¼‚æ­¥</a></li><li class="sidebar-sub-header"><a href="/blog/schemadesigner/å®ç°å¼‚æ­¥æ‰§è¡Œçš„å…«ç§æ–¹å¼.html#_4-3-completablefutureå®ç°å¼‚æ­¥" class="sidebar-link">4.3 CompletableFutureå®ç°å¼‚æ­¥</a></li><li class="sidebar-sub-header"><a href="/blog/schemadesigner/å®ç°å¼‚æ­¥æ‰§è¡Œçš„å…«ç§æ–¹å¼.html#_4-4-springçš„-asyncå¼‚æ­¥" class="sidebar-link">4.4 Springçš„@Asyncå¼‚æ­¥</a></li><li class="sidebar-sub-header"><a href="/blog/schemadesigner/å®ç°å¼‚æ­¥æ‰§è¡Œçš„å…«ç§æ–¹å¼.html#_4-5-spring-applicationeventäº‹ä»¶å®ç°å¼‚æ­¥" class="sidebar-link">4.5 Spring ApplicationEventäº‹ä»¶å®ç°å¼‚æ­¥</a></li><li class="sidebar-sub-header"><a href="/blog/schemadesigner/å®ç°å¼‚æ­¥æ‰§è¡Œçš„å…«ç§æ–¹å¼.html#_4-6-æ¶ˆæ¯é˜Ÿåˆ—" class="sidebar-link">4.6 æ¶ˆæ¯é˜Ÿåˆ—</a></li><li class="sidebar-sub-header"><a href="/blog/schemadesigner/å®ç°å¼‚æ­¥æ‰§è¡Œçš„å…«ç§æ–¹å¼.html#_4-7-threadutilå¼‚æ­¥å·¥å…·ç±»" class="sidebar-link">4.7 ThreadUtilå¼‚æ­¥å·¥å…·ç±»</a></li><li class="sidebar-sub-header"><a href="/blog/schemadesigner/å®ç°å¼‚æ­¥æ‰§è¡Œçš„å…«ç§æ–¹å¼.html#_4-8-guavaå¼‚æ­¥" class="sidebar-link">4.8 Guavaå¼‚æ­¥</a></li><li class="sidebar-sub-header"><a href="/blog/schemadesigner/å®ç°å¼‚æ­¥æ‰§è¡Œçš„å…«ç§æ–¹å¼.html#ç›¸å…³é“¾æ¥" class="sidebar-link">ç›¸å…³é“¾æ¥</a></li></ul></li></ul></li><li><a href="/blog/schemadesigner/å®šæ—¶ä»»åŠ¡.html" class="sidebar-link">xxl-jobå®šæ—¶ä»»åŠ¡</a></li><li><a href="/blog/schemadesigner/è®¢å•è¶…æ—¶å–æ¶ˆçš„ä¸‰ç§æ–¹æ¡ˆ.html" class="sidebar-link">è®¢å•è¶…æ—¶è‡ªåŠ¨å–æ¶ˆçš„ä¸‰ç§æ–¹æ¡ˆ</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="å®ç°å¼‚æ­¥çš„-8-ç§æ–¹å¼"><a href="#å®ç°å¼‚æ­¥çš„-8-ç§æ–¹å¼" class="header-anchor">#</a> å®ç°å¼‚æ­¥çš„ 8 ç§æ–¹å¼</h1> <h2 id="ä¸€ã€å‰è¨€"><a href="#ä¸€ã€å‰è¨€" class="header-anchor">#</a> ä¸€ã€å‰è¨€</h2> <p>â€œ å¼‚æ­¥æ‰§è¡Œå¯¹äºå¼€å‘è€…æ¥è¯´å¹¶ä¸é™Œç”Ÿï¼Œåœ¨å®é™…çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¤šåœºæ™¯å¤šä¼šä½¿ç”¨åˆ°å¼‚æ­¥ï¼Œç›¸æ¯”åŒæ­¥æ‰§è¡Œï¼Œå¼‚æ­¥å¯ä»¥å¤§å¤§ç¼©çŸ­è¯·æ±‚é“¾è·¯è€—æ—¶æ—¶é—´ï¼Œæ¯”å¦‚ï¼š<strong>ã€Œå‘é€çŸ­ä¿¡ã€é‚®ä»¶ã€å¼‚æ­¥æ›´æ–°ç­‰ã€</strong>ï¼Œè¿™äº›éƒ½æ˜¯å…¸å‹çš„å¯ä»¥é€šè¿‡å¼‚æ­¥å®ç°çš„åœºæ™¯ã€‚â€</p> <h2 id="äºŒã€å®ç°å¼‚æ­¥çš„-8-ç§æ–¹å¼"><a href="#äºŒã€å®ç°å¼‚æ­¥çš„-8-ç§æ–¹å¼" class="header-anchor">#</a> äºŒã€å®ç°å¼‚æ­¥çš„ 8 ç§æ–¹å¼</h2> <ol><li>çº¿ç¨‹Thread</li> <li>Future</li> <li>å¼‚æ­¥æ¡†æ¶CompletableFuture</li> <li>Springæ³¨è§£@Async</li> <li>Spring ApplicationEventäº‹ä»¶</li> <li>æ¶ˆæ¯é˜Ÿåˆ—</li> <li>ç¬¬ä¸‰æ–¹å¼‚æ­¥æ¡†æ¶ï¼Œæ¯”å¦‚Hutoolçš„ThreadUtil</li> <li>Guavaå¼‚æ­¥</li></ol> <h2 id="ä¸‰ã€ä»€ä¹ˆæ˜¯å¼‚æ­¥"><a href="#ä¸‰ã€ä»€ä¹ˆæ˜¯å¼‚æ­¥" class="header-anchor">#</a> ä¸‰ã€ä»€ä¹ˆæ˜¯å¼‚æ­¥ï¼Ÿ</h2> <p>é¦–å…ˆæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªå¸¸è§çš„ç”¨æˆ·ä¸‹å•çš„åœºæ™¯ï¼š</p> <p><img src="https://cdn.jsdelivr.net/gh/BXuan-Yang/blogImage/img/image-20230314093231475.png" alt="image-20230314093231475"></p> <p><strong>ä»€ä¹ˆæ˜¯å¼‚æ­¥</strong></p> <p>åœ¨åŒæ­¥æ“ä½œä¸­ï¼Œæˆ‘ä»¬æ‰§è¡Œåˆ° <strong>ã€Œå‘é€çŸ­ä¿¡ã€</strong> çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¿…é¡»ç­‰å¾…è¿™ä¸ªæ–¹æ³•å½»åº•æ‰§è¡Œå®Œæ‰èƒ½æ‰§è¡Œ <strong>ã€Œèµ é€ç§¯åˆ†ã€</strong> è¿™ä¸ªæ“ä½œï¼Œå¦‚æœ <strong>ã€Œèµ é€ç§¯åˆ†ã€</strong> è¿™ä¸ªåŠ¨ä½œæ‰§è¡Œæ—¶é—´è¾ƒé•¿ï¼Œå‘é€çŸ­ä¿¡éœ€è¦ç­‰å¾…ï¼Œè¿™å°±æ˜¯å…¸å‹çš„åŒæ­¥åœºæ™¯ã€‚</p> <p>å®é™…ä¸Šï¼Œå‘é€çŸ­ä¿¡å’Œèµ é€ç§¯åˆ†æ²¡æœ‰ä»»ä½•çš„ä¾èµ–å…³ç³»ï¼Œé€šè¿‡å¼‚æ­¥ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°<code>èµ é€ç§¯åˆ†</code>å’Œ<code>å‘é€çŸ­ä¿¡</code>è¿™ä¸¤ä¸ªæ“ä½œèƒ½å¤ŸåŒæ—¶è¿›è¡Œï¼Œæ¯”å¦‚ï¼š</p> <p><img src="https://cdn.jsdelivr.net/gh/BXuan-Yang/blogImage/img/image-20230314093249758.png" alt="image-20230314093249758"></p> <p><strong>å¼‚æ­¥</strong></p> <p>è¿™å°±æ˜¯æ‰€è°“çš„å¼‚æ­¥ï¼Œæ˜¯ä¸æ˜¯éå¸¸ç®€å•ï¼Œä¸‹é¢å°±è¯´è¯´å¼‚æ­¥çš„å‡ ç§å®ç°æ–¹å¼å§ã€‚</p> <h2 id="å››ã€å¼‚æ­¥ç¼–ç¨‹"><a href="#å››ã€å¼‚æ­¥ç¼–ç¨‹" class="header-anchor">#</a> å››ã€å¼‚æ­¥ç¼–ç¨‹</h2> <h3 id="_4-1-çº¿ç¨‹å¼‚æ­¥"><a href="#_4-1-çº¿ç¨‹å¼‚æ­¥" class="header-anchor">#</a> 4.1 çº¿ç¨‹å¼‚æ­¥</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AsyncThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Current thread name:&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; Send email success!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">AsyncThread</span> asyncThread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AsyncThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        asyncThread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å½“ç„¶å¦‚æœæ¯æ¬¡éƒ½åˆ›å»ºä¸€ä¸ª<code>Thread</code>çº¿ç¨‹ï¼Œé¢‘ç¹çš„åˆ›å»ºã€é”€æ¯ï¼Œæµªè´¹ç³»ç»Ÿèµ„æºï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨çº¿ç¨‹æ± ï¼š</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    executorService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰§è¡Œä¸šåŠ¡é€»è¾‘...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å¯ä»¥å°†ä¸šåŠ¡é€»è¾‘å°è£…åˆ°<code>Runnable</code>æˆ–<code>Callable</code>ä¸­ï¼Œäº¤ç”±çº¿ç¨‹æ± æ¥æ‰§è¡Œã€‚</p> <h3 id="_4-2future-å¼‚æ­¥"><a href="#_4-2future-å¼‚æ­¥" class="header-anchor">#</a> 4.2Future å¼‚æ­¥</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">YiBuTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@SneakyThrows</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">YiBuTest</span> yiBuTest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">YiBuTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        yiBuTest<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token class-name">ExecutorService</span> executor <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> executor<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot; --- task start --- &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot; --- task finish ---&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token string">&quot;this is future execute final result!!!&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> res <span class="token operator">=</span> future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Future get result: {}&quot;</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¾“å‡ºç»“æœï¼š</p> <p><img src="https://cdn.jsdelivr.net/gh/BXuan-Yang/blogImage/img/image-20230314094233462.png" alt="image-20230314094233462"></p> <p>Futureçš„ä¸è¶³ä¹‹å¤„çš„åŒ…æ‹¬ä»¥ä¸‹å‡ ç‚¹ï¼š</p> <p>1ï¸âƒ£ <strong>æ— æ³•è¢«åŠ¨æ¥æ”¶å¼‚æ­¥ä»»åŠ¡çš„è®¡ç®—ç»“æœ</strong>ï¼šè™½ç„¶æˆ‘ä»¬å¯ä»¥ä¸»åŠ¨å°†å¼‚æ­¥ä»»åŠ¡æäº¤ç»™çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ¥æ‰§è¡Œï¼Œä½†æ˜¯å¾…å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œç»“æŸä¹‹åï¼Œä¸»çº¿ç¨‹æ— æ³•å¾—åˆ°ä»»åŠ¡å®Œæˆä¸å¦çš„é€šçŸ¥ï¼Œå®ƒéœ€è¦é€šè¿‡getæ–¹æ³•ä¸»åŠ¨è·å–ä»»åŠ¡æ‰§è¡Œçš„ç»“æœã€‚</p> <p>2ï¸âƒ£ <strong>Futureä»¶å½¼æ­¤å­¤ç«‹</strong>ï¼šæœ‰æ—¶æŸä¸€ä¸ªè€—æ—¶å¾ˆé•¿çš„å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œç»“æŸä¹‹åï¼Œä½ æƒ³åˆ©ç”¨å®ƒè¿”å›çš„ç»“æœå†åšè¿›ä¸€æ­¥çš„è¿ç®—ï¼Œè¯¥è¿ç®—ä¹Ÿä¼šæ˜¯ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œä¸¤è€…ä¹‹é—´çš„å…³ç³»éœ€è¦ç¨‹åºå¼€å‘äººå‘˜æ‰‹åŠ¨è¿›è¡Œç»‘å®šèµ‹äºˆï¼ŒFutureå¹¶ä¸èƒ½å°†å…¶å½¢æˆä¸€ä¸ªä»»åŠ¡æµï¼ˆpipelineï¼‰ï¼Œæ¯ä¸€ä¸ªFutureéƒ½æ˜¯å½¼æ­¤ä¹‹é—´éƒ½æ˜¯å­¤ç«‹çš„ï¼Œæ‰€ä»¥æ‰æœ‰äº†åé¢çš„CompletableFutureï¼ŒCompletableFutureå°±å¯ä»¥å°†å¤šä¸ªFutureä¸²è”èµ·æ¥å½¢æˆä»»åŠ¡æµã€‚</p> <p>3ï¸âƒ£ <strong>Futrueæ²¡æœ‰å¾ˆå¥½çš„é”™è¯¯å¤„ç†æœºåˆ¶</strong>ï¼šæˆªæ­¢ç›®å‰ï¼Œå¦‚æœæŸä¸ªå¼‚æ­¥ä»»åŠ¡åœ¨æ‰§è¡Œå‘çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†å¼‚å¸¸ï¼Œè°ƒç”¨è€…æ— æ³•è¢«åŠ¨æ„ŸçŸ¥ï¼Œå¿…é¡»é€šè¿‡æ•è·getæ–¹æ³•çš„å¼‚å¸¸æ‰çŸ¥æ™“å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œæ˜¯å¦å‡ºç°äº†é”™è¯¯ï¼Œä»è€Œåœ¨åšè¿›ä¸€æ­¥çš„åˆ¤æ–­å¤„ç†ã€‚</p> <h3 id="_4-3-completablefutureå®ç°å¼‚æ­¥"><a href="#_4-3-completablefutureå®ç°å¼‚æ­¥" class="header-anchor">#</a> <strong>4.3 CompletableFutureå®ç°å¼‚æ­¥</strong></h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">YiBuTest</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">thenRunAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@SneakyThrows</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">thenRunAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> completableFuture01 <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; completableFuture01 do something....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> completableFuture02 <span class="token operator">=</span> completableFuture01<span class="token punctuation">.</span><span class="token function">thenRunAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; completableFuture02 do something....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ç­‰å¾…ä»»åŠ¡1æ‰§è¡Œå®Œæˆ</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;cf1ç»“æœ-&gt;&quot;</span> <span class="token operator">+</span> completableFuture01<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ç­‰å¾…ä»»åŠ¡2æ‰§è¡Œå®Œæˆ</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;cf2ç»“æœ-&gt;&quot;</span> <span class="token operator">+</span> completableFuture02<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ‰§è¡Œç»“æœï¼š</p> <p><img src="https://cdn.jsdelivr.net/gh/BXuan-Yang/blogImage/img/image-20230314094754200.png" alt="image-20230314094754200"></p> <p>æˆ‘ä»¬ä¸éœ€è¦æ˜¾å¼ä½¿ç”¨ExecutorServiceï¼ŒCompletableFuture å†…éƒ¨ä½¿ç”¨äº†<code>ForkJoinPool</code>æ¥å¤„ç†å¼‚æ­¥ä»»åŠ¡ï¼Œå¦‚æœåœ¨æŸäº›ä¸šåŠ¡åœºæ™¯æˆ‘ä»¬æƒ³è‡ªå®šä¹‰è‡ªå·±çš„å¼‚æ­¥çº¿ç¨‹æ± ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p> <h3 id="_4-4-springçš„-asyncå¼‚æ­¥"><a href="#_4-4-springçš„-asyncå¼‚æ­¥" class="header-anchor">#</a> <strong>4.4 Springçš„@Asyncå¼‚æ­¥</strong></h3> <h4 id="_4-4-1-è‡ªå®šä¹‰å¼‚æ­¥çº¿ç¨‹æ± "><a href="#_4-4-1-è‡ªå®šä¹‰å¼‚æ­¥çº¿ç¨‹æ± " class="header-anchor">#</a> 4.4.1 è‡ªå®šä¹‰å¼‚æ­¥çº¿ç¨‹æ± </h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * çº¿ç¨‹æ± å‚æ•°é…ç½®ï¼Œå¤šä¸ªçº¿ç¨‹æ± å®ç°çº¿ç¨‹æ± éš”ç¦»ï¼Œ@Asyncæ³¨è§£ï¼Œé»˜è®¤ä½¿ç”¨ç³»ç»Ÿè‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Œå¯åœ¨é¡¹ç›®ä¸­è®¾ç½®å¤šä¸ªçº¿ç¨‹æ± ï¼Œåœ¨å¼‚æ­¥è°ƒç”¨çš„æ—¶å€™ï¼ŒæŒ‡æ˜éœ€è¦è°ƒç”¨çš„çº¿ç¨‹æ± åç§°ï¼Œæ¯”å¦‚ï¼š@Async(&quot;taskName&quot;)
@EnableAsync
@Configuration
public class TaskPoolConfig {
    /**
     * è‡ªå®šä¹‰çº¿ç¨‹æ± 
     *
     **/</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;taskExecutor&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Executor</span> <span class="token function">taskExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//è¿”å›å¯ç”¨å¤„ç†å™¨çš„Javaè™šæ‹Ÿæœºçš„æ•°é‡ 12</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">availableProcessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç³»ç»Ÿæœ€å¤§çº¿ç¨‹æ•°  ï¼š &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ThreadPoolTaskExecutor</span> executor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolTaskExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ ¸å¿ƒçº¿ç¨‹æ± å¤§å°</span>
        executor<span class="token punctuation">.</span><span class="token function">setCorePoolSize</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æœ€å¤§çº¿ç¨‹æ•°</span>
        executor<span class="token punctuation">.</span><span class="token function">setMaxPoolSize</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//é…ç½®é˜Ÿåˆ—å®¹é‡ï¼Œé»˜è®¤å€¼ä¸ºInteger.MAX_VALUE</span>
        executor<span class="token punctuation">.</span><span class="token function">setQueueCapacity</span><span class="token punctuation">(</span><span class="token number">99999</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ´»è·ƒæ—¶é—´</span>
        executor<span class="token punctuation">.</span><span class="token function">setKeepAliveSeconds</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//çº¿ç¨‹åå­—å‰ç¼€</span>
        executor<span class="token punctuation">.</span><span class="token function">setThreadNamePrefix</span><span class="token punctuation">(</span><span class="token string">&quot;asyncServiceExecutor -&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è®¾ç½®æ­¤æ‰§è¡Œç¨‹åºåº”è¯¥åœ¨å…³é—­æ—¶é˜»æ­¢çš„æœ€å¤§ç§’æ•°ï¼Œä»¥ä¾¿åœ¨å®¹å™¨çš„å…¶ä½™éƒ¨åˆ†ç»§ç»­å…³é—­ä¹‹å‰ç­‰å¾…å‰©ä½™çš„ä»»åŠ¡å®Œæˆä»–ä»¬çš„æ‰§è¡Œ</span>
        executor<span class="token punctuation">.</span><span class="token function">setAwaitTerminationSeconds</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ç­‰å¾…æ‰€æœ‰çš„ä»»åŠ¡ç»“æŸåå†å…³é—­çº¿ç¨‹æ± </span>
        executor<span class="token punctuation">.</span><span class="token function">setWaitForTasksToCompleteOnShutdown</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> executor<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_4-4-2-asyncservice"><a href="#_4-4-2-asyncservice" class="header-anchor">#</a> 4.4.2 AsyncService</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">AsyncService</span> <span class="token punctuation">{</span>

    <span class="token class-name">MessageResult</span> <span class="token function">sendSms</span><span class="token punctuation">(</span><span class="token class-name">String</span> callPrefix<span class="token punctuation">,</span> <span class="token class-name">String</span> mobile<span class="token punctuation">,</span> <span class="token class-name">String</span> actionType<span class="token punctuation">,</span> <span class="token class-name">String</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">MessageResult</span> <span class="token function">sendEmail</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">,</span> <span class="token class-name">String</span> subject<span class="token punctuation">,</span> <span class="token class-name">String</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AsyncServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AsyncService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">IMessageHandler</span> mesageHandler<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token annotation punctuation">@Async</span><span class="token punctuation">(</span><span class="token string">&quot;taskExecutor&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">MessageResult</span> <span class="token function">sendSms</span><span class="token punctuation">(</span><span class="token class-name">String</span> callPrefix<span class="token punctuation">,</span> <span class="token class-name">String</span> mobile<span class="token punctuation">,</span> <span class="token class-name">String</span> actionType<span class="token punctuation">,</span> <span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>

            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mesageHandler<span class="token punctuation">.</span><span class="token function">sendSms</span><span class="token punctuation">(</span>callPrefix<span class="token punctuation">,</span> mobile<span class="token punctuation">,</span> actionType<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;å‘é€çŸ­ä¿¡å¼‚å¸¸ -&gt; &quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token annotation punctuation">@Async</span><span class="token punctuation">(</span><span class="token string">&quot;taskExecutor&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token function">sendEmail</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">,</span> <span class="token class-name">String</span> subject<span class="token punctuation">,</span> <span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>

            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mesageHandler<span class="token punctuation">.</span><span class="token function">sendsendEmail</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span> subject<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;å‘é€emailå¼‚å¸¸ -&gt; &quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œ ä½¿ç”¨<code>@Async</code>è°ƒç”¨çº¿ç¨‹æ± ï¼Œæ¨èç­‰æ–¹å¼æ˜¯æ˜¯ä½¿ç”¨è‡ªå®šä¹‰çº¿ç¨‹æ± çš„æ¨¡å¼ï¼Œä¸æ¨èç›´æ¥ä½¿ç”¨@Asyncç›´æ¥å®ç°å¼‚æ­¥ã€‚</strong></p> <h3 id="_4-5-spring-applicationeventäº‹ä»¶å®ç°å¼‚æ­¥"><a href="#_4-5-spring-applicationeventäº‹ä»¶å®ç°å¼‚æ­¥" class="header-anchor">#</a> <strong>4.5 Spring ApplicationEventäº‹ä»¶å®ç°å¼‚æ­¥</strong></h3> <h4 id="_4-5-1-å®šä¹‰äº‹ä»¶"><a href="#_4-5-1-å®šä¹‰äº‹ä»¶" class="header-anchor">#</a> 4.5.1 å®šä¹‰äº‹ä»¶</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AsyncSendEmailEvent</span> <span class="token keyword">extends</span> <span class="token class-name">ApplicationEvent</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * é‚®ç®±
     **/</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>

   <span class="token comment">/**
     * ä¸»é¢˜
     **/</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> subject<span class="token punctuation">;</span>

    <span class="token comment">/**
     * å†…å®¹
     **/</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> content<span class="token punctuation">;</span>
  
    <span class="token comment">/**
     * æ¥æ”¶è€…
     **/</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> targetUserId<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="_4-5-2-å®šä¹‰äº‹ä»¶å¤„ç†å™¨"><a href="#_4-5-2-å®šä¹‰äº‹ä»¶å¤„ç†å™¨" class="header-anchor">#</a> 4.5.2 å®šä¹‰äº‹ä»¶å¤„ç†å™¨</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AsyncSendEmailEventHandler</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AsyncSendEmailEvent</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">IMessageHandler</span> mesageHandler<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Async</span><span class="token punctuation">(</span><span class="token string">&quot;taskExecutor&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onApplicationEvent</span><span class="token punctuation">(</span><span class="token class-name">AsyncSendEmailEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>event <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">String</span> email <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> subject <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> content <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> targetUserId <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getTargetUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mesageHandler<span class="token punctuation">.</span><span class="token function">sendsendEmailSms</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span> subject<span class="token punctuation">,</span> content<span class="token punctuation">,</span> targerUserId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å¦å¤–ï¼Œå¯èƒ½æœ‰äº›æ—¶å€™é‡‡ç”¨ ApplicationEvent å®ç°å¼‚æ­¥çš„ä½¿ç”¨ï¼Œå½“ç¨‹åºå‡ºç°å¼‚å¸¸é”™è¯¯çš„æ—¶å€™ï¼Œéœ€è¦è€ƒè™‘è¡¥å¿æœºåˆ¶ï¼Œé‚£ä¹ˆè¿™æ—¶å€™å¯ä»¥ç»“åˆSpring Retryé‡è¯•æ¥å¸®åŠ©æˆ‘ä»¬é¿å…è¿™ç§å¼‚å¸¸é€ æˆæ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚</p> <h3 id="_4-6-æ¶ˆæ¯é˜Ÿåˆ—"><a href="#_4-6-æ¶ˆæ¯é˜Ÿåˆ—" class="header-anchor">#</a> <strong>4.6 æ¶ˆæ¯é˜Ÿåˆ—</strong></h3> <h4 id="_4-6-1-å›è°ƒäº‹ä»¶æ¶ˆæ¯ç”Ÿäº§è€…"><a href="#_4-6-1-å›è°ƒäº‹ä»¶æ¶ˆæ¯ç”Ÿäº§è€…" class="header-anchor">#</a> 4.6.1 å›è°ƒäº‹ä»¶æ¶ˆæ¯ç”Ÿäº§è€…</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CallbackProducer</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">AmqpTemplate</span> amqpTemplate<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendCallbackMessage</span><span class="token punctuation">(</span><span class="token class-name">CallbackDTO</span> allbackDTO<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token keyword">long</span> delayTimes<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼ŒcallbackDTOï¼Œ{}&quot;</span><span class="token punctuation">,</span> callbackDTO<span class="token punctuation">)</span><span class="token punctuation">;</span>

        amqpTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token class-name">CallbackQueueEnum</span><span class="token punctuation">.</span><span class="token constant">QUEUE_GENSEE_CALLBACK</span><span class="token punctuation">.</span><span class="token function">getExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">CallbackQueueEnum</span><span class="token punctuation">.</span><span class="token constant">QUEUE_GENSEE_CALLBACK</span><span class="token punctuation">.</span><span class="token function">getRoutingKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">JsonMapper</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>genseeCallbackDTO<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MessagePostProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Message</span> <span class="token function">postProcessMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AmqpException</span> <span class="token punctuation">{</span>
                <span class="token comment">//ç»™æ¶ˆæ¯è®¾ç½®å»¶è¿Ÿæ¯«ç§’å€¼ï¼Œé€šè¿‡ç»™æ¶ˆæ¯è®¾ç½®x-delayå¤´æ¥è®¾ç½®æ¶ˆæ¯ä»äº¤æ¢æœºå‘é€åˆ°é˜Ÿåˆ—çš„å»¶è¿Ÿæ—¶é—´</span>
                message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;x-delay&quot;</span><span class="token punctuation">,</span> delayTimes<span class="token punctuation">)</span><span class="token punctuation">;</span>
                message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCorrelationId</span><span class="token punctuation">(</span>callbackDTO<span class="token punctuation">.</span><span class="token function">getSdkId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> message<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_4-6-2-å›è°ƒäº‹ä»¶æ¶ˆæ¯æ¶ˆè´¹è€…"><a href="#_4-6-2-å›è°ƒäº‹ä»¶æ¶ˆæ¯æ¶ˆè´¹è€…" class="header-anchor">#</a> 4.6.2 å›è°ƒäº‹ä»¶æ¶ˆæ¯æ¶ˆè´¹è€…</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">&quot;message.callback&quot;</span><span class="token punctuation">,</span> containerFactory <span class="token operator">=</span> <span class="token string">&quot;rabbitListenerContainerFactory&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CallbackConsumer</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">IGlobalUserService</span> globalUserService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RabbitHandler</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token class-name">String</span> json<span class="token punctuation">,</span> <span class="token class-name">Channel</span> channel<span class="token punctuation">,</span> <span class="token annotation punctuation">@Headers</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//å¦è®¤æ¶ˆæ¯</span>
            channel<span class="token punctuation">.</span><span class="token function">basicNack</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">AmqpHeaders</span><span class="token punctuation">.</span><span class="token constant">DELIVERY_TAG</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
        
            <span class="token class-name">CallbackDTO</span> callbackDTO <span class="token operator">=</span> <span class="token class-name">JsonMapper</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> <span class="token class-name">CallbackDTO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//æ‰§è¡Œä¸šåŠ¡é€»è¾‘</span>
            globalUserService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>callbackDTO<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//æ¶ˆæ¯æ¶ˆæ¯æˆåŠŸæ‰‹åŠ¨ç¡®è®¤ï¼Œå¯¹åº”æ¶ˆæ¯ç¡®è®¤æ¨¡å¼acknowledge-mode: manual</span>
            channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">AmqpHeaders</span><span class="token punctuation">.</span><span class="token constant">DELIVERY_TAG</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;å›è°ƒå¤±è´¥ -&gt; {}&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-7-threadutilå¼‚æ­¥å·¥å…·ç±»"><a href="#_4-7-threadutilå¼‚æ­¥å·¥å…·ç±»" class="header-anchor">#</a> <strong>4.7 ThreadUtilå¼‚æ­¥å·¥å…·ç±»</strong></h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadUtils</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">ThreadUtil</span><span class="token punctuation">.</span><span class="token function">execAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token class-name">ThreadLocalRandom</span> threadLocalRandom <span class="token operator">=</span> <span class="token class-name">ThreadLocalRandom</span><span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> number <span class="token operator">=</span> threadLocalRandom<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;å½“å‰ç¬¬ï¼š&quot;</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">&quot;ä¸ªçº¿ç¨‹&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;task finish!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-8-guavaå¼‚æ­¥"><a href="#_4-8-guavaå¼‚æ­¥" class="header-anchor">#</a> <strong>4.8 Guavaå¼‚æ­¥</strong></h3> <p><code>Guava</code>çš„<code>ListenableFuture</code>é¡¾åæ€ä¹‰å°±æ˜¯å¯ä»¥ç›‘å¬çš„<code>Future</code>ï¼Œæ˜¯å¯¹javaåŸç”ŸFutureçš„æ‰©å±•å¢å¼ºã€‚æˆ‘ä»¬çŸ¥é“Futureè¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥è®¡ç®—ä»»åŠ¡ï¼Œå½“ä»»åŠ¡å®Œæˆæ—¶å¯ä»¥å¾—åˆ°è®¡ç®—ç»“æœã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›ä¸€æ—¦è®¡ç®—å®Œæˆå°±æ‹¿åˆ°ç»“æœå±•ç¤ºç»™ç”¨æˆ·æˆ–è€…åšå¦å¤–çš„è®¡ç®—ï¼Œå°±å¿…é¡»ä½¿ç”¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸æ–­çš„æŸ¥è¯¢è®¡ç®—çŠ¶æ€ã€‚è¿™æ ·åšï¼Œä»£ç å¤æ‚ï¼Œè€Œä¸”æ•ˆç‡ä½ä¸‹ã€‚ä½¿ç”¨**ã€ŒGuava ListenableFutureã€**å¯ä»¥å¸®æˆ‘ä»¬æ£€æµ‹Futureæ˜¯å¦å®Œæˆäº†ï¼Œä¸éœ€è¦å†é€šè¿‡get()æ–¹æ³•è‹¦è‹¦ç­‰å¾…å¼‚æ­¥çš„è®¡ç®—ç»“æœï¼Œå¦‚æœå®Œæˆå°±è‡ªåŠ¨è°ƒç”¨å›è°ƒå‡½æ•°ï¼Œè¿™æ ·å¯ä»¥å‡å°‘å¹¶å‘ç¨‹åºçš„å¤æ‚åº¦ã€‚</p> <p><code>ListenableFuture</code>æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒä»<code>jdk</code>çš„<code>Future</code>æ¥å£ç»§æ‰¿ï¼Œæ·»åŠ äº†<code>void addListener(Runnable listener, Executor executor)</code>æ–¹æ³•ã€‚</p> <p>æˆ‘ä»¬çœ‹ä¸‹å¦‚ä½•ä½¿ç”¨ListenableFutureã€‚é¦–å…ˆéœ€è¦å®šä¹‰ListenableFutureçš„å®ä¾‹:</p> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token class-name">ListeningExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">MoreExecutors</span><span class="token punctuation">.</span><span class="token function">listeningDecorator</span><span class="token punctuation">(</span><span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">ListenableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> listenableFuture <span class="token operator">=</span> executorService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;callable execute...&quot;</span><span class="token punctuation">)</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>é¦–å…ˆé€šè¿‡<code>MoreExecutors</code>ç±»çš„é™æ€æ–¹æ³•<code>listeningDecorator</code>æ–¹æ³•åˆå§‹åŒ–ä¸€ä¸ª<code>ListeningExecutorService</code>çš„æ–¹æ³•ï¼Œç„¶åä½¿ç”¨æ­¤å®ä¾‹çš„<code>submit</code>æ–¹æ³•å³å¯åˆå§‹åŒ–<code>ListenableFuture</code>å¯¹è±¡ã€‚</p> <p><code>ListenableFuture</code>è¦åšçš„å·¥ä½œï¼Œåœ¨Callableæ¥å£çš„å®ç°ç±»ä¸­å®šä¹‰ï¼Œè¿™é‡Œåªæ˜¯ä¼‘çœ äº†1ç§’é’Ÿç„¶åè¿”å›ä¸€ä¸ªæ•°å­—1ï¼Œæœ‰äº†ListenableFutureå®ä¾‹ï¼Œå¯ä»¥æ‰§è¡Œæ­¤Futureå¹¶æ‰§è¡ŒFutureå®Œæˆä¹‹åçš„å›è°ƒå‡½æ•°ã€‚</p> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token class-name">Futures</span><span class="token punctuation">.</span><span class="token function">addCallback</span><span class="token punctuation">(</span>listenableFuture<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">FutureCallback</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSuccess</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//æˆåŠŸæ‰§è¡Œ...</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Get listenable future's result with callback &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onFailure</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//å¼‚å¸¸æƒ…å†µå¤„ç†...</span>
        t<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="header-anchor">#</a> ç›¸å…³é“¾æ¥</h3> <p><a href="https://mp.weixin.qq.com/s/sQptVCekKOn8YIrodhgchw" target="_blank" rel="noopener noreferrer">å®ç°å¼‚æ­¥çš„8ç§æ–¹å¼<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/blog/schemadesigner/å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¹¶å‘ç³»ç»Ÿ.html" class="prev">
        å¦‚ä½•è®¾è®¡ä¸€ä¸ªä¼˜ç§€çš„é«˜å¹¶å‘ç³»ç»Ÿ
      </a></span> <span class="next"><a href="/blog/schemadesigner/å®šæ—¶ä»»åŠ¡.html">
        xxl-jobå®šæ—¶ä»»åŠ¡
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.c7952645.js" defer></script><script src="/assets/js/2.53ba99d7.js" defer></script><script src="/assets/js/74.91e1d2ef.js" defer></script>
  </body>
</html>
